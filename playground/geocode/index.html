<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAb8jJ_aU1WfGgxweqASR7xoeZ7cKKKHeI&callback=initMap&libraries=&v=weekly"
        defer>
    </script>
    <title>Map</title>
    <style>
        #map {
            width: 500px;
            height: 500px;
            margin: 50px auto;
        }
    </style>
</head>

<body>
    <button onclick="getLocation()">Get My Location</button>
    <div id="map"></div>
    <script>

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(geoSuccess);

                function geoSuccess(position) {
                    var lat = position.coords.latitude;
                    var lng = position.coords.longitude;
                    alert(lat+ "    "+ lng)

                    initMap()
                    getAddress(lat, lng)

                    function initMap() {

                        let map;

                        const options = {
                            center: { lat, lng },
                            zoom: 15
                        }
                        map = new google.maps.Map(document.getElementById("map"), options);

                        // listen for click on map
                        google.maps.event.addListener(map, 'click', function (event) {
                            addMarker({ coords: event.latLng })
                        })

                        const markers = [
                            {
                                coords: { lat, lng },
                                iconImage: '',
                                content: '<h1>Westgate</h1>'
                            }
                        ]

                        markers.forEach(marker => {
                            addMarker(marker)
                        })

                        // Add marker function 
                        function addMarker(props) {
                            const marker = new google.maps.Marker({
                                position: props.coords,
                                map: map,
                                icon: props.iconImage
                            })

                            if (props.iconImage) {
                                marker.setIcon(props.iconImage)
                            }

                            if (props.content) {
                                const infoWindow = new google.maps.InfoWindow({
                                    content: props.content
                                })

                                marker.addListener('click', function () {
                                    infoWindow.open(map, marker)
                                })
                            }
                        }
                    }

                    // Get the address

                    function getAddress(lat, lng) {
                        var geocoder = new google.maps.Geocoder();

                        var latlng = new google.maps.LatLng(lat, lng);
                        geocoder.geocode({ 'latLng': latlng }, function (results, status) {
                            if (status == google.maps.GeocoderStatus.OK) {
                                console.log(results)
                                if (results[1]) {
                                    //formatted address
                                    var address = results[0].formatted_address;
                                    alert("address = " + address);
                                } else {
                                    alert("No results found");
                                }
                            } else {
                                alert("Geocoder failed due to: " + status);
                            }
                        });
                    }
                }

            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

    </script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAb8jJ_aU1WfGgxweqASR7xoeZ7cKKKHeI&callback=initMap&libraries=&v=weekly"
        defer>
    </script>
</body>

</html>